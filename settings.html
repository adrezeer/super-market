<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>إعدادات النظام</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Color System */
      --primary: #2196F3;
      --primary-dark: #1976D2;
      --primary-light: #E3F2FD;
      --secondary: #FF9800;
      --danger: #e53935;
      --danger-dark: #c62828;
      --success: #4CAF50;
      --success-dark: #388E3C;
      --warning: #FF9800;
      
      /* Neutral Colors */
      --white: #ffffff;
      --gray-50: #f8fafc;
      --gray-100: #f1f5f9;
      --gray-200: #e2e8f0;
      --gray-300: #cbd5e1;
      --gray-400: #94a3b8;
      --gray-500: #64748b;
      --gray-700: #334155;
      --gray-900: #0f172a;
      
      /* Special Colors */
      --accent: #8b5cf6;
      --info: #06b6d4;
      
      /* Typography */
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.875rem;
      --font-size-base: 1rem;
      --font-size-lg: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-2xl: 1.5rem;
      --font-size-3xl: 1.875rem;
      --font-size-4xl: 2.25rem;
      
      --font-weight-normal: 400;
      --font-weight-medium: 600;
      --font-weight-bold: 700;
      
      /* Spacing */
      --space-1: 0.25rem;
      --space-2: 0.5rem;
      --space-3: 0.75rem;
      --space-4: 1rem;
      --space-5: 1.25rem;
      --space-6: 1.5rem;
      --space-8: 2rem;
      --space-10: 2.5rem;
      --space-12: 3rem;
      --space-16: 4rem;
      
      /* Border Radius */
      --radius-sm: 0.375rem;
      --radius: 0.5rem;
      --radius-md: 0.75rem;
      --radius-lg: 1rem;
      --radius-xl: 1.5rem;
      --radius-full: 9999px;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      
      /* Transitions */
      --transition-fast: 150ms ease-in-out;
      --transition-base: 250ms ease-in-out;
      --transition-slow: 400ms ease-in-out;
      
      /* Layout */
      --container-sm: 640px;
      --container-md: 768px;
      --container-lg: 1024px;
      --container-xl: 1280px;
    }
    
    /* Reset and Base Styles */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html {
      scroll-behavior: smooth;
      -webkit-text-size-adjust: 100%;
    }
    
    body {
      font-family: "Cairo", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-normal);
      line-height: 1.6;
      color: var(--gray-700);
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--accent) 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-4);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M40 40c0-11.05-8.95-20-20-20s-20 8.95-20 20 8.95 20 20 20 20-8.95 20-20zm20 0c0-11.05-8.95-20-20-20s-20 8.95-20 20 8.95 20 20 20 20-8.95 20-20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
      z-index: -1;
    }
    
    /* Main Container */
    .container {
      background: var(--white);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-xl);
      width: 100%;
      max-width: 500px;
      overflow: hidden;
      position: relative;
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
    }
    
    /* Header */
    .header {
      background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
      padding: var(--space-8) var(--space-6) var(--space-6);
      text-align: center;
      border-bottom: 1px solid var(--gray-200);
    }
    
    .header-title {
      font-size: var(--font-size-3xl);
      font-weight: var(--font-weight-bold);
      color: var(--gray-900);
      margin-bottom: var(--space-2);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
    }
    
    .header-subtitle {
      color: var(--gray-500);
      font-size: var(--font-size-base);
    }
    
    /* Content */
    .content {
      padding: var(--space-8) var(--space-6);
    }
    
    /* Form Sections */
    .section {
      margin-bottom: var(--space-8);
    }
    
    .section:last-child {
      margin-bottom: 0;
    }
    
    .section-title {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-medium);
      color: var(--gray-900);
      margin-bottom: var(--space-4);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }
    
    .section-description {
      font-size: var(--font-size-sm);
      color: var(--gray-500);
      margin-bottom: var(--space-4);
    }
    
    /* Form Elements */
    .form-group {
      margin-bottom: var(--space-6);
    }
    
    .form-label {
      display: block;
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      color: var(--gray-700);
      margin-bottom: var(--space-2);
    }
    
    .input {
      width: 100%;
      padding: var(--space-4);
      border: 2px solid var(--gray-200);
      border-radius: var(--radius);
      font-size: var(--font-size-base);
      font-family: inherit;
      transition: all var(--transition-fast);
      background: var(--white);
    }
    
    .input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
      transform: translateY(-1px);
    }
    
    .input:hover {
      border-color: var(--gray-300);
    }
    
    .input::placeholder {
      color: var(--gray-400);
    }
    
    /* File Input */
    .file-input-wrapper {
      position: relative;
      display: inline-block;
      width: 100%;
    }
    
    .file-input {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    .file-input-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      width: 100%;
      padding: var(--space-4);
      border: 2px dashed var(--gray-300);
      border-radius: var(--radius);
      background: var(--gray-50);
      color: var(--gray-600);
      font-size: var(--font-size-base);
      transition: all var(--transition-fast);
      cursor: pointer;
    }
    
    .file-input-button:hover {
      border-color: var(--primary);
      background: var(--primary-light);
      color: var(--primary-dark);
    }
    
    .file-input-button.has-file {
      border-color: var(--success);
      background: #f0fdf4;
      color: var(--success-dark);
    }
    
    /* Logo Preview */
    .logo-preview {
      margin-top: var(--space-4);
      text-align: center;
    }
    
    .preview-image {
      max-width: 120px;
      max-height: 120px;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      transition: transform var(--transition-base);
    }
    
    .preview-image:hover {
      transform: scale(1.05);
    }
    
    .preview-placeholder {
      width: 120px;
      height: 120px;
      background: var(--gray-100);
      border: 2px dashed var(--gray-300);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--gray-400);
      font-size: var(--font-size-lg);
      margin: 0 auto;
    }
    
    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      padding: var(--space-4) var(--space-6);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-medium);
      font-family: inherit;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      transition: all var(--transition-fast);
      text-decoration: none;
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left var(--transition-base);
    }
    
    .btn:hover::before {
      left: 100%;
    }
    
    .btn:active {
      transform: translateY(1px);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: var(--white);
      box-shadow: var(--shadow);
    }
    
    .btn-primary:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: var(--gray-100);
      color: var(--gray-700);
      border: 1px solid var(--gray-200);
    }
    
    .btn-secondary:hover {
      background: var(--gray-200);
      border-color: var(--gray-300);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
      color: var(--white);
    }
    
    .btn-success {
      background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
      color: var(--white);
    }
    
    /* Button Groups */
    .button-group {
      display: flex;
      gap: var(--space-3);
      flex-wrap: wrap;
    }
    
    .button-group .btn {
      flex: 1;
      min-width: 0;
    }
    
    /* Messages */
    .message {
      padding: var(--space-4);
      border-radius: var(--radius);
      margin-bottom: var(--space-4);
      display: flex;
      align-items: center;
      gap: var(--space-2);
      font-weight: var(--font-weight-medium);
      animation: slideIn var(--transition-base) ease-out;
    }
    
    .message-success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #10b981;
    }
    
    .message-error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #ef4444;
    }
    
    .message-info {
      background: #dbeafe;
      color: #1e40af;
      border: 1px solid #3b82f6;
    }
    
    /* Data Management */
    .data-section {
      background: var(--gray-50);
      border: 1px solid var(--gray-200);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
      margin-top: var(--space-6);
    }
    
    .data-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: var(--space-4);
      margin-bottom: var(--space-4);
    }
    
    .stat-item {
      text-align: center;
      padding: var(--space-3);
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
    }
    
    .stat-number {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      color: var(--primary);
    }
    
    .stat-label {
      font-size: var(--font-size-sm);
      color: var(--gray-500);
      margin-top: var(--space-1);
    }
    
    /* Footer */
    .footer {
      padding: var(--space-6);
      background: var(--gray-50);
      border-top: 1px solid var(--gray-200);
    }
    
    /* Animations */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .fade-in {
      animation: fadeIn var(--transition-base) ease-out;
    }
    
    /* Loading State */
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid transparent;
      border-top: 2px solid currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      body {
        padding: var(--space-2);
      }
      
      .container {
        max-width: 100%;
      }
      
      .header {
        padding: var(--space-6) var(--space-4) var(--space-4);
      }
      
      .header-title {
        font-size: var(--font-size-2xl);
      }
      
      .content {
        padding: var(--space-6) var(--space-4);
      }
      
      .button-group {
        flex-direction: column;
      }
      
      .data-stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 480px) {
      .header-title {
        font-size: var(--font-size-xl);
        flex-direction: column;
        gap: var(--space-1);
      }
      
      .data-stats {
        grid-template-columns: 1fr;
      }
    }
    
    /* Print Styles */
    @media print {
      body {
        background: white;
      }
      
      .container {
        box-shadow: none;
        border: 1px solid var(--gray-300);
      }
      
      .btn {
        display: none;
      }
    }
    
    /* Focus styles for accessibility */
    .btn:focus-visible,
    .input:focus-visible,
    .file-input:focus-visible + .file-input-button {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1 class="header-title">
      <span>⚙️</span>
      <span>إعدادات النظام</span>
    </h1>
    <p class="header-subtitle">قم بتخصيص إعدادات السوبر ماركت الخاص بك</p>
  </div>

  <div class="content">
    <div id="messageContainer"></div>

    <!-- Market Name Section -->
    <div class="section">
      <h2 class="section-title">
        <span>🏪</span>
        معلومات السوبر ماركت
      </h2>
      <p class="section-description">أدخل اسم السوبر ماركت الذي سيظهر في جميع الصفحات والفواتير</p>
      
      <div class="form-group">
        <label class="form-label" for="marketName">اسم السوبر ماركت</label>
        <input 
          type="text" 
          id="marketName" 
          class="input" 
          placeholder="مثال: سوبر ماركت الأمل"
          maxlength="50"
        >
      </div>
    </div>

    <!-- Logo Section -->
    <div class="section">
      <h2 class="section-title">
        <span>🎨</span>
        شعار السوبر ماركت
      </h2>
      <p class="section-description">اختر صورة لشعار السوبر ماركت (يفضل أن تكون مربعة الشكل)</p>
      
      <div class="form-group">
        <label class="form-label">اختر ملف الشعار</label>
        <div class="file-input-wrapper">
          <input 
            type="file" 
            id="logoInput" 
            class="file-input" 
            accept="image/*"
          >
          <div class="file-input-button" id="fileButton">
            <span>📁</span>
            <span>اختر ملف الصورة</span>
          </div>
        </div>
      </div>

      <div class="logo-preview">
        <div id="preview" class="preview-placeholder">
          <span>🖼️</span>
        </div>
      </div>
    </div>

    <!-- Data Management Section -->
    <div class="section">
      <div class="data-section">
        <h2 class="section-title">
          <span>💾</span>
          إدارة البيانات
        </h2>
        
        <div class="data-stats" id="dataStats">
          <div class="stat-item">
            <div class="stat-number" id="productCount">0</div>
            <div class="stat-label">المنتجات</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="workerCount">0</div>
            <div class="stat-label">العمال</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="dataSize">0</div>
            <div class="stat-label">حجم البيانات (KB)</div>
          </div>
        </div>

        <div class="button-group">
          <button class="btn btn-secondary" onclick="settingsManager.exportData()">
            <span>📤</span>
            تصدير البيانات
          </button>
          <button class="btn btn-secondary" onclick="settingsManager.importData()">
            <span>📥</span>
            استيراد البيانات
          </button>
          <button class="btn btn-danger" onclick="settingsManager.clearAllData()">
            <span>🗑️</span>
            مسح جميع البيانات
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    <div class="button-group">
      <button class="btn btn-primary" onclick="settingsManager.saveSettings()">
        <span>💾</span>
        حفظ الإعدادات
      </button>
      <a href="index.html" class="btn btn-secondary">
        <span>⬅️</span>
        العودة للرئيسية
      </a>
    </div>
  </div>
</div>

<script>
  class SettingsManager {
    constructor() {
      this.init();
    }

    init() {
      this.loadCurrentSettings();
      this.setupEventListeners();
      this.updateDataStats();
    }

    loadCurrentSettings() {
      // Load current market name
      const currentName = localStorage.getItem("marketName") || "";
      document.getElementById("marketName").value = currentName;

      // Load current logo
      const currentLogo = localStorage.getItem("marketLogo");
      if (currentLogo) {
        this.displayPreview(currentLogo);
      }
    }

    setupEventListeners() {
      const logoInput = document.getElementById("logoInput");
      const fileButton = document.getElementById("fileButton");

      logoInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          // Validate file size (max 2MB)
          if (file.size > 2 * 1024 * 1024) {
            this.showMessage("حجم الصورة كبير جداً. يجب أن يكون أقل من 2 ميجابايت", "error");
            logoInput.value = "";
            return;
          }

          // Validate file type
          if (!file.type.startsWith('image/')) {
            this.showMessage("يجب اختيار ملف صورة صحيح", "error");
            logoInput.value = "";
            return;
          }

          fileButton.innerHTML = `
            <span>✅</span>
            <span>${file.name}</span>
          `;
          fileButton.classList.add('has-file');

          // Preview the image
          const reader = new FileReader();
          reader.onload = (e) => {
            this.displayPreview(e.target.result);
          };
          reader.readAsDataURL(file);
        } else {
          fileButton.innerHTML = `
            <span>📁</span>
            <span>اختر ملف الصورة</span>
          `;
          fileButton.classList.remove('has-file');
        }
      });

      // Auto-save on name change
      document.getElementById("marketName").addEventListener('input', () => {
        clearTimeout(this.nameTimeout);
        this.nameTimeout = setTimeout(() => {
          this.saveSettings(false);
        }, 1000);
      });
    }

    displayPreview(imageSrc) {
      const preview = document.getElementById("preview");
      preview.innerHTML = `<img src="${imageSrc}" class="preview-image fade-in" alt="معاينة الشعار">`;
    }

    saveSettings(showMessage = true) {
      const name = document.getElementById("marketName").value.trim();
      const logoFile = document.getElementById("logoInput").files[0];

      // Validation
      if (!name && !logoFile && !localStorage.getItem("marketLogo")) {
        this.showMessage("من فضلك أدخل اسم السوبر ماركت على الأقل", "error");
        return;
      }

      // Save market name
      if (name) {
        localStorage.setItem("marketName", name);
      }

      // Save logo if selected
      if (logoFile) {
        const reader = new FileReader();
        reader.onload = (e) => {
          localStorage.setItem("marketLogo", e.target.result);
          if (showMessage) {
            this.showMessage("✅ تم حفظ الإعدادات بنجاح!", "success");
          }
          this.updateDataStats();
        };
        reader.readAsDataURL(logoFile);
      } else {
        if (showMessage) {
          this.showMessage("✅ تم حفظ الإعدادات بنجاح!", "success");
        }
        this.updateDataStats();
      }
    }

    updateDataStats() {
      const items = JSON.parse(localStorage.getItem("items") || "[]");
      const workers = JSON.parse(localStorage.getItem("workers") || "[]");
      
      // Calculate total data size
      let totalSize = 0;
      for (let key in localStorage) {
        if (localStorage.hasOwnProperty(key)) {
          totalSize += localStorage[key].length;
        }
      }
      
      document.getElementById("productCount").textContent = items.length;
      document.getElementById("workerCount").textContent = workers.length;
      document.getElementById("dataSize").textContent = Math.round(totalSize / 1024);
    }

    exportData() {
      const data = {
        marketName: localStorage.getItem("marketName"),
        marketLogo: localStorage.getItem("marketLogo"),
        items: JSON.parse(localStorage.getItem("items") || "[]"),
        workers: JSON.parse(localStorage.getItem("workers") || "[]"),
        exportDate: new Date().toISOString(),
        version: "1.0"
      };

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `supermarket_backup_${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);

      this.showMessage("تم تصدير البيانات بنجاح", "success");
    }

    importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            
            // Validate data structure
            if (!data.version) {
              throw new Error("ملف غير صحيح");
            }

            if (confirm("هل أنت متأكد من استيراد البيانات؟ سيتم استبدال البيانات الحالية.")) {
              // Import data
              if (data.marketName) localStorage.setItem("marketName", data.marketName);
              if (data.marketLogo) localStorage.setItem("marketLogo", data.marketLogo);
              if (data.items) localStorage.setItem("items", JSON.stringify(data.items));
              if (data.workers) localStorage.setItem("workers", JSON.stringify(data.workers));

              // Reload settings
              this.loadCurrentSettings();
              this.updateDataStats();
              
              this.showMessage("تم استيراد البيانات بنجاح", "success");
            }
          } catch (error) {
            this.showMessage("خطأ في قراءة الملف. تأكد من أنه ملف صحيح", "error");
          }
        };
        reader.readAsText(file);
      };
      
      input.click();
    }

    clearAllData() {
      const confirmText = "هل أنت متأكد من حذف جميع البيانات؟ هذا الإجراء لا يمكن التراجع عنه.";
      const doubleConfirm = "اكتب 'حذف' للتأكيد:";
      
      if (confirm(confirmText)) {
        const userInput = prompt(doubleConfirm);
        if (userInput === "حذف") {
          // Clear all data
          localStorage.removeItem("marketName");
          localStorage.removeItem("marketLogo");
          localStorage.removeItem("items");
          localStorage.removeItem("workers");
          
          // Reset form
          document.getElementById("marketName").value = "";
          document.getElementById("logoInput").value = "";
          document.getElementById("preview").innerHTML = `
            <div class="preview-placeholder">
              <span>🖼️</span>
            </div>
          `;
          
          const fileButton = document.getElementById("fileButton");
          fileButton.innerHTML = `
            <span>📁</span>
            <span>اختر ملف الصورة</span>
          `;
          fileButton.classList.remove('has-file');
          
          this.updateDataStats();
          this.showMessage("تم حذف جميع البيانات", "info");
        } else {
          this.showMessage("تم إلغاء العملية", "info");
        }
      }
    }

    showMessage(message, type = 'info') {
      // Remove existing messages
      const existingMessages = document.querySelectorAll('.message');
      existingMessages.forEach(msg => msg.remove());

      const messageEl = document.createElement('div');
      messageEl.className = `message message-${type}`;
      
      const icon = {
        success: '✅',
        error: '❌',
        warning: '⚠️',
        info: 'ℹ️'
      };

      messageEl.innerHTML = `
        <span>${icon[type]}</span>
        <span>${message}</span>
      `;

      const container = document.getElementById('messageContainer');
      container.appendChild(messageEl);

      // Auto-remove after 4 seconds
      setTimeout(() => {
        if (messageEl.parentNode) {
          messageEl.remove();
        }
      }, 4000);

      // Scroll to message
      messageEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    resetSettings() {
      if (confirm("هل تريد إعادة تعيين جميع الإعدادات؟")) {
        localStorage.removeItem("marketName");
        localStorage.removeItem("marketLogo");
        this.loadCurrentSettings();
        this.showMessage("تم إعادة تعيين الإعدادات", "info");
      }
    }

    // Advanced features
    optimizeStorage() {
      // Remove any corrupted or invalid data
      const items = JSON.parse(localStorage.getItem("items") || "[]");
      const workers = JSON.parse(localStorage.getItem("workers") || "[]");
      
      // Clean items
      const cleanItems = items.filter(item => 
        item && item.barcode && item.name && item.price
      );
      
      // Clean workers
      const cleanWorkers = workers.filter(worker => 
        worker && worker.name
      );

      localStorage.setItem("items", JSON.stringify(cleanItems));
      localStorage.setItem("workers", JSON.stringify(cleanWorkers));
      
      this.updateDataStats();
      this.showMessage(`تم تنظيف البيانات. تم إزالة ${items.length - cleanItems.length} منتج و ${workers.length - cleanWorkers.length} عامل غير صالح`, "success");
    }

    generateReport() {
      const data = {
        marketName: localStorage.getItem("marketName") || "غير محدد",
        itemCount: JSON.parse(localStorage.getItem("items") || "[]").length,
        workerCount: JSON.parse(localStorage.getItem("workers") || "[]").length,
        hasLogo: !!localStorage.getItem("marketLogo"),
        reportDate: new Date().toLocaleDateString('ar-EG'),
        reportTime: new Date().toLocaleTimeString('ar-EG')
      };

      const reportContent = `
تقرير النظام
==============

اسم السوبر ماركت: ${data.marketName}
تاريخ التقرير: ${data.reportDate}
وقت التقرير: ${data.reportTime}

الإحصائيات:
- عدد المنتجات: ${data.itemCount}
- عدد العمال: ${data.workerCount}
- يوجد شعار: ${data.hasLogo ? 'نعم' : 'لا'}

تم إنشاء هذا التقرير بواسطة نظام إدارة السوبر ماركت
      `;

      const blob = new Blob([reportContent], { type: 'text/plain; charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `system_report_${new Date().toISOString().split('T')[0]}.txt`;
      a.click();
      URL.revokeObjectURL(url);

      this.showMessage("تم إنشاء التقرير بنجاح", "success");
    }
  }

  // Initialize the settings manager
  const settingsManager = new SettingsManager();

  // Global functions for onclick handlers (maintaining compatibility)
  function saveSettings() {
    settingsManager.saveSettings();
  }

  // Legacy support
  window.onload = () => {
    // Already handled in constructor
  };

  // Add some advanced features via console
  console.log('🔧 نظام الإعدادات المطور');
  console.log('الوظائف المتاحة:');
  console.log('settingsManager.optimizeStorage() - تنظيف وتحسين البيانات');
  console.log('settingsManager.generateReport() - إنشاء تقرير النظام');
  console.log('settingsManager.resetSettings() - إعادة تعيين الإعدادات');
</script>

</body>
</html>